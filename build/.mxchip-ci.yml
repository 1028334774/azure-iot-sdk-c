name: $(BuildID)_$(BuildDefinitionName)_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:.r)

jobs:
- job: Cross_Compile
  pool:
    vmImage: ubuntu-16.04
  steps:
  - script: |
      . build_all/mbed5/setup.sh
    displayName: 'setup'
  - script: |
      . build_all/mbed5/build.sh
    displayName: 'build'
  # - script: |
  #     cd $(Build.SourcesDirectory)
  #     ls -al
  #   displayName: "list Build.SourcesDirectory"
  - script: |
      # Check that this is the right source directory
      ls
      cp mxchip/BUILD/AZ3166/GCC_ARM/mxchip.bin $(Build.ArtifactStagingDirectory)
    displayName: "Copy Files into Artifact repo"

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifacts: drop'
    inputs:
      pathtoPublish: '$(Build.ArtifactStagingDirectory)'
      artifactName: 'drop.bin'
      publishLocation: 'Container'
    condition: succeeded()

- job: Execute
  pool:
    name: devicelab-01
  steps:
  - checkout: none
  - task: DownloadBuildArtifacts@0
    displayName: 'Download Build Artifacts'
    inputs:
      artifactName: 'drop.bin'
  - script: |
      pwd
      ls
      cp drop.bin /media/john/AZ31661
    displayName: 'deploy'
